# Data Flow - Luồng Dữ Liệu Chi Tiết

```mermaid
sequenceDiagram
    participant User
    participant Browser
    participant FastAPI
    participant JSON as summaries.json
    participant Script as update_news.py
    participant Pipeline
    participant Techmeme
    participant Gemini

    Note over User,Gemini: Scenario 1: Admin Update Data (Manual)
    
    User->>Script: Chạy: python update_news.py --top 30
    Script->>Pipeline: Khởi tạo NewsPipeline()
    activate Pipeline
    
    Pipeline->>Techmeme: FeedService.fetch_latest_articles()
    Techmeme-->>Pipeline: Return: List[Article] (15 items)
    
    loop Summarize từng bài
        Pipeline->>Gemini: SummarizationService.summarize(article)
        Gemini-->>Pipeline: AI-generated summary (2-3 câu)
    end
    
    Pipeline->>JSON: StorageService.save_summaries()
    JSON-->>Pipeline: Saved successfully
    deactivate Pipeline
    
    Script-->>User: ✓ Saved 15 summaries
    
    Note over User,Gemini: ---
    Note over User,Gemini: Scenario 2: User Xem Tin (Automatic)
    
    User->>Browser: Mở http://localhost:8000
    Browser->>FastAPI: GET /
    FastAPI-->>Browser: Return news.html
    
    Browser->>Browser: Load JavaScript (main.js)
    Browser->>FastAPI: GET /api/summaries
    activate FastAPI
    
    FastAPI->>JSON: Read file
    JSON-->>FastAPI: Return data
    FastAPI->>FastAPI: Add metadata (freshness, total)
    
    FastAPI-->>Browser: JSON Response (< 1s)
    deactivate FastAPI
    
    Browser->>Browser: Parse JSON → Render UI
    Browser-->>User: Hiển thị các bài tin
    
    Note over User,Browser: User thấy 15 bài viết đã tóm tắt ✅
```

---

## Timeline Estimates

### Update Flow (Scenario 1)
```
0s   → User chạy script
1s   → Pipeline khởi tạo
2-5s → Fetch RSS từ Techmeme (network delay)
5-30s → AI tóm tắt 15 bài (2s/bài × 15)
30s  → Ghi file JSON (instant)
31s  → Script hoàn thành

Total: ~30-35 giây
```

### API Serving Flow (Scenario 2)
```
0ms   → User mở browser
100ms → HTML loaded
200ms → JavaScript loaded
300ms → API call: GET /api/summaries
350ms → FastAPI đọc JSON file (50ms)
400ms → Response sent (50ms)
500ms → Browser parse & render (100ms)

Total: ~500ms (< 1 giây)
```

---

## Data Flow Map

```
┌─────────────────────────────────────────────────────────┐
│                    UPDATE PIPELINE                      │
│  (Manual - Chạy khi cần cập nhật tin)                  │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
    ┌──────────────────────────────────────┐
    │  1. Fetch from Techmeme              │
    │     Input: RSS URL                   │
    │     Output: List[RawArticle]         │
    └──────────────────┬───────────────────┘
                       │
                       ▼
    ┌──────────────────────────────────────┐
    │  2. AI Summarize (Gemini)            │
    │     Input: Article content           │
    │     Output: Summary (2-3 sentences)  │
    └──────────────────┬───────────────────┘
                       │
                       ▼
    ┌──────────────────────────────────────┐
    │  3. Save to JSON                     │
    │     Format: {summaries: [...]}       │
    │     Size: ~11KB (15 items)           │
    └──────────────────┬───────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────┐
│              STORAGE (summaries.json)                   │
│  - last_updated: ISO timestamp                          │
│  - total_items: Integer                                 │
│  - summaries: Array[Summary]                            │
└─────────────────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────┐
│                    API SERVING                          │
│  (Automatic - Server luôn chạy)                         │
└─────────────────────────────────────────────────────────┘
                       │
                       ▼
    ┌──────────────────────────────────────┐
    │  1. FastAPI Read JSON                │
    │     I/O: Disk read (~50ms)           │
    └──────────────────┬───────────────────┘
                       │
                       ▼
    ┌──────────────────────────────────────┐
    │  2. Add Metadata                     │
    │     - freshness: "2 hours ago"       │
    │     - total: 15                      │
    └──────────────────┬───────────────────┘
                       │
                       ▼
    ┌──────────────────────────────────────┐
    │  3. Return JSON Response             │
    │     Content-Type: application/json   │
    │     Size: ~11KB                      │
    └──────────────────┬───────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────┐
│                 FRONTEND (Browser)                      │
│  - Parse JSON                                           │
│  - Render HTML cards                                    │
│  - Setup filters, keyboard shortcuts                    │
└─────────────────────────────────────────────────────────┘
```
